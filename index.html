<!doctype html>
<html lang="{{ page.lang or 'pl' }}" class="no-motion" data-theme="{{ user_preferred_theme or 'system' }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ff7a1a" />
  <title>{{ page.seo_title or page.title or 'Kras-Trans — Transport ekspresowy' }}</title>
  <meta name="description" content="{{ page.meta_desc or page.lead or 'Transport ekspresowy i dedykowany — Polska & Europa' }}" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{{ page.og_title or page.seo_title or page.title }}" />
  <meta property="og:description" content="{{ page.og_desc or page.meta_desc or page.lead }}" />
  <meta property="og:image" content="{{ page.og_image or '/assets/media/og-default.jpg' }}" />
  <meta property="og:url" content="{{ page.url or '/' }}" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ page.seo_title or page.title }}" />
  <meta name="twitter:description" content="{{ page.meta_desc or page.lead }}" />
  <meta name="twitter:image" content="{{ page.og_image or '/assets/media/og-default.jpg' }}" />
  <!-- Preload critical assets (fonts, CSS) -->
  <link rel="preload" href="/assets/fonts/InterVariable.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/assets/fonts/InterVariable-Italic.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/assets/css/kras-global.css" as="style" />
  <link rel="preload" href="/assets/css/kras-ui.css" as="style" />
  <!-- Asynchronous CSS loading (prevents render-blocking) -->
  <link rel="stylesheet" href="/assets/css/kras-global.css" media="print" onload="this.media='all'; this.onload=null;" />
  <link rel="stylesheet" href="/assets/css/kras-ui.css" media="print" onload="this.media='all'; this.onload=null;" />
  <noscript>
    <!-- Fallback for no-JS: load CSS normally -->
    <link rel="stylesheet" href="/assets/css/kras-global.css" />
    <link rel="stylesheet" href="/assets/css/kras-ui.css" />
  </noscript>
  <style>
    /* Visually hidden utility (for accessibility) */
    .visually-hidden { position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); clip-path:inset(50%); white-space:nowrap; border:0; }
  </style>
  <script>
    // Dodanie linków alternatywnych dla różnych języków (hreflang), jeśli dane dostępne w CMS
    (function(){
      const data = window.CMS_DATA || {};
      const { slugKey } = window.CMS_PAGE || {};
      const map = (data.hreflang || {})[slugKey];
      if (!map) return;
      Object.entries(map).forEach(([lang, href]) => {
        const link = document.createElement('link');
        link.rel = 'alternate';
        link.hreflang = (lang === 'ua') ? 'uk' : lang;
        link.href = href;
        document.head.appendChild(link);
      });
      // x-default link (fallback to PL or EN)
      const x = document.createElement('link');
      x.rel = 'alternate';
      x.hreflang = 'x-default';
      x.href = map.en || map.pl;
      document.head.appendChild(x);
    })();
  </script>
</head>
<body>
  <!-- Tła dekoracyjne: siatka i animowane patyczki (ukryte do idle) -->
  <div id="bg-grid" aria-hidden="true"></div>
  <canvas id="bg-canvas" aria-hidden="true" hidden></canvas>

  <!-- HEADER: Nagłówek strony (sticky, przezroczysty z efektem rozmycia tła) -->
  <header class="site-header">
    <div class="container header-grid">
      <!-- Logo firmy -->
      <a class="brand" href="/">
        <img src="/assets/media/logo-firma-transportowa-kras-trans.png" alt="{{ company[0].name or 'Kras-Trans' }}" width="132" height="32" loading="eager" fetchpriority="high" />
      </a>
      <!-- Główna nawigacja (uzupełniana dynamicznie) -->
      <nav id="site-nav" class="nav" hidden aria-label="{{ strings.nav_main or 'Główna nawigacja' }}"></nav>
      <div class="header-actions">
        <!-- Przycisk przełączania motywu (jasny/ciemny/e-book) -->
        <button id="theme-toggle" class="icon-btn theme-toggle" aria-label="{{ strings.theme_toggle or 'Zmień motyw' }}" aria-pressed="false">
          <span class="sun"></span><span class="moon"></span><span class="paper"></span>
        </button>
        <!-- Główny CTA w headerze (np. Wyceń) -->
        <a class="btn primary btn--shine" href="#kontakt">{{ strings.cta_call or 'Wyceń' }}</a>
      </div>
    </div>
    <!-- Mega Menu (desktop) - uzupełniane przez menu-builder.js -->
    <div id="mega-root" class="mega" hidden></div>
  </header>

  <main id="main" class="content" role="main">
    <!-- HERO SECTION: Duże hero z tłem wideo/obrazkiem, hasłem i CTA -->
    <section class="hero" id="hero">
      <div class="container hero-wrap">
        <div class="hero-copy">
          <span class="claim">{{ page.claim or 'Kompleksowe usługi transportowe' }}</span>
          <h1>{{ page.h1 or page.title }}</h1>
          {% if page.lead %}
          <p class="lead">{{ page.lead }}</p>
          {% endif %}
          <p class="hero-cta">
            <a class="btn primary" href="#kontakt">{{ strings.hero_cta_primary or 'Wyceń transport teraz' }}</a>
            <a class="btn" href="tel:{{ (company and company[0].telephone) or '+48793927467' }}">{{ strings.hero_cta_secondary or 'Zadzwoń' }}</a>
          </p>
          <!-- Dymek "Jak to działa" (pokazywany dynamicznie po kliknięciu CTA "Wyceń") -->
          <aside class="howto" id="howto" hidden aria-live="polite">
            <ol>
              <li>Kliknij „Wyceń transport teraz”.</li>
              <li>Wpisz trasę i dane ładunku.</li>
              <li>Wyślij – oddzwonimy i potwierdzimy odbiór.</li>
            </ol>
          </aside>
        </div>
        {% if page.hero_video %}
          <!-- Tło wideo hero (lazy inicjacja) -->
          <video class="hero-media" muted loop playsinline preload="none" poster="{{ page.hero_poster or '' }}" width="1680" height="720">
            <source src="{{ page.hero_video or '/assets/media/hero.mp4' }}" type="video/mp4" />
          </video>
        {% elif page.hero_image %}
          <!-- Tło obrazkowe hero -->
          <img class="hero-media" src="{{ page.hero_image }}" alt="{{ page.hero_alt or page.h1 }}" width="1680" height="720" loading="eager" fetchpriority="high" />
        {% endif %}
      </div>
    </section>

    <!-- OFFER SECTION: Sekcja "Nasza oferta" z kafelkami usług (dynamiczne z CMS) -->
    <section class="section split-hero split-hero--narrow" id="offer-reveal" data-section="offers" data-style="edge" data-accent="amber" aria-label="{{ strings.offers_aria or 'Nasza oferta' }}">
      <div class="split-hero__sticky">
        <div class="split-hero__stack">
          <!-- Podzielony tytuł sekcji (animacja "heading split") -->
          <div class="split-hero__title" aria-hidden="true">
            <span class="title-half title-left">{{ strings.offers_title or 'Nasza oferta' }}</span>
            <span class="title-half title-right">{{ strings.offers_title or 'Nasza oferta' }}</span>
          </div>
          <h2 class="visually-hidden">{{ strings.offers_title or 'Nasza oferta' }}</h2>
          <!-- Lista kafelków ofert (przewijana w poziomie na mobile) -->
          <div class="split-hero__rail tilt-cards" id="offer-rail" role="list" aria-label="{{ strings.offers_list or 'Usługi (przesuń w bok na telefonie)' }}">
            <!-- Kafelki usług generowane na podstawie CMS (pętla po elementach "offer") -->
            {% for service in offers %}
            <a role="listitem" class="offer-card" href="{{ service.url }}">
              {% if service.media %}
              <img src="{{ service.media }}" alt="" width="{{ service.img_w or 1280 }}" height="{{ service.img_h or 720 }}" loading="lazy" decoding="async" />
              {% endif %}
              <span class="offer-card__title">{{ service.title }}</span>
              {% if service.desc or service.lead %}
              <span class="offer-card__desc">{{ service.desc or service.lead }}</span>
              {% endif %}
            </a>
            {% endfor %}
            <!-- (Przykładowy statyczny kafelek jako wzór) -->
            <!-- 
            <a role="listitem" class="offer-card" href="/pl/trasy-ekspresowe/">
              <img src="/assets/media/offer-1.jpg" alt="" width="1280" height="720" />
              <span class="offer-card__title">Transport ekspresowy</span>
              <span class="offer-card__desc">Dedykowany transport 24/7 na terenie całej UE</span>
            </a>
            -->
          </div>
        </div>
      </div>
      <!-- Dekoracyjny separator falisty między sekcjami (animacja morph) -->
      <div class="sep sep--morph" data-morph="wave-2" aria-hidden="true"></div>
    </section>

    <!-- MAP SECTION: Sekcja "Kierunki" z osadzoną mapą tras -->
    <section class="section" id="kierunki" data-section="kierunki" data-style="glass" aria-label="{{ strings.routes_title or 'Kierunki' }}">
      <div class="container text">
        <h2>{{ strings.routes_title or 'Kierunki' }}</h2>
      </div>
      <div class="container">
        <div class="iframe-wrap" style="aspect-ratio:16/9;">
          <!-- Osadzona mapa kierunków (ładowna leniwie) -->
          <iframe class="routes-map" title="Mapa kierunków" 
                  width="560" height="315" 
                  loading="lazy" 
                  src="" data-src="/assets/media/mapa-kierunkow-kras-trans.html" 
                  sandbox="allow-scripts allow-same-origin" referrerpolicy="no-referrer">
          </iframe>
        </div>
      </div>
    </section>

    <!-- FAQ SECTION: Najczęściej zadawane pytania -->
    <section class="section faq" id="faq" aria-label="{{ strings.faq_title or 'Najczęściej zadawane pytania' }}">
      <div class="container">
        <h2>{{ strings.faq_title or 'FAQ' }}</h2>
        <!-- Lista pytań i odpowiedzi generowana z CMS (każdy element jako <details>) -->
        {% for item in faq %}
        <details>
          <summary>{{ item.question }}</summary>
          <div>{{ item.answer }}</div>
        </details>
        {% endfor %}
        <!-- Przykładowy element FAQ: -->
        <!-- 
        <details>
          <summary>Jak szybko realizowane są transporty?</summary>
          <div>Nasza firma świadczy usługi ekspresowe, większość transportów realizujemy w ciągu 24 godzin od zlecenia.</div>
        </details>
        -->
      </div>
    </section>
  </main>

  <!-- FOOTER: Stopka strony z danymi kontaktowymi (id="kontakt") -->
  <footer class="site-footer" id="kontakt">
    <div class="container footer-grid">
      <div>
        <img src="/assets/media/logo-firma-transportowa-kras-trans.png" width="120" height="28" alt="Kras-Trans" loading="lazy" />
        <div class="company">
          <strong>{{ company[0].name or 'Kras-Trans' }}</strong><br/>
          {% if company and company[0].street_address %}{{ company[0].street_address }}{% endif %}{% if company and company[0].postal_code %}, {{ company[0].postal_code }}{% endif %}{% if company and company[0].city %} {{ company[0].city }}{% endif %}<br/>
          <a href="tel:{{ (company and company[0].telephone) or '+48793927467' }}">{{ (company and company[0].telephone) or '+48 793 927 467' }}</a><br/>
          <a href="mailto:{{ (company and company[0].email) or 'biuro@kras-trans.pl' }}">{{ (company and company[0].email) or 'biuro@kras-trans.pl' }}</a>
        </div>
      </div>
      <!-- Linki w stopce (uzupełniane z CMS/nav) -->
      <nav class="footer-links" aria-label="{{ strings.nav_footer or 'Nawigacja w stopce' }}"></nav>
    </div>
    <div class="container">
      <small>© {{ (now or '')[:4] or '' }} {{ company[0].name or 'Kras-Trans' }} — Ekspresowy transport 24/7</small>
    </div>
  </footer>

  <!-- BOTTOM NAV: Dolny pasek nawigacji mobilnej -->
  <nav class="bottom-dock" aria-label="Szybka nawigacja">
    <a class="dock-btn dock-home" href="/{{ page.lang or 'pl' }}/" aria-label="{{ strings.home or 'Start' }}">
      <span></span><em>Start</em>
    </a>
    <a class="dock-btn dock-quote" href="#kontakt" aria-label="{{ strings.quote or 'Wyceń' }}">
      <span></span><em>Wyceń</em>
    </a>
    <button class="dock-btn dock-menu" id="dock-menu" aria-label="{{ strings.menu or 'Menu' }}">
      <span></span><em>Menu</em>
    </button>
  </nav>

  <!-- NEON MENU: Pełnoekranowe menu nawigacyjne (overlay) -->
  <div id="neon-menu" class="neon" hidden aria-modal="true" role="dialog">
    <div class="neon__inner">
      <button class="neon__close" aria-label="{{ strings.close or 'Zamknij' }}">×</button>
      <!-- Główne linki nawigacyjne (uzupełnia buildMenu() na podstawie #site-nav lub window.KRAS_NAV) -->
      <nav class="neon__nav" aria-label="{{ strings.nav_main or 'Główna nawigacja' }}"></nav>
      <!-- Linki językowe (flagi języków) generowane dynamicznie przez buildMenu() -->
      <div class="neon__langs" aria-label="{{ strings.nav_langs or 'Języki' }}"></div>
    </div>
  </div>

  <!-- SCRIPTS: konfiguracja nawigacji i dołączanie skryptów -->
  <script>
    /* Globalna konfiguracja menu z CMS (wstawiana podczas build) */
    window.KRAS_NAV = {{ nav_cfg | tojson }};
  </script>
  <script src="/assets/js/kras-global.js" defer></script>
  <script src="/assets/js/menu-builder.js" defer></script>
  <!-- Ładowanie głównego skryptu interfejsu po wczytaniu strony (idle) -->
  <script>
    (window.requestIdleCallback || window.setTimeout)(function(){
      const s = document.createElement('script');
      s.src = "/assets/js/kras-ui.js";
      s.defer = true;
      document.body.appendChild(s);
    });
  </script>
</body>
</html>
