<!doctype html>
<html lang="{{ page.lang or DEFAULT_LANG }}">
<head>
  {% if page.hero_image %}
  <link rel="preload" as="image" href="{{ page.hero_image }}" imagesrcset="{{ page.hero_image }} 1680w" fetchpriority="high">
  {% endif %}

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32"  href="/assets/media/ikona-transport-logistyka-europa-32.png">
  <link rel="icon" type="image/png" sizes="64x64"  href="/assets/media/ikona-transport-logistyka-europa-64.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/assets/media/ikona-transport-logistyka-europa-128.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/assets/media/ikona-transport-logistyka-europa-256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/assets/media/ikona-transport-logistyka-europa-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/media/ikona-transport-logistyka-europa-256.png">

  <!-- Basic -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#0b0f17">

  {% set _title = page.seo_title or page.title or page.h1 or 'Kras-Trans' %}
  {% set _desc  = page.meta_desc or page.description or page.lead or 'Transport i spedycja — Polska & UE' %}
  <title>{{ _title }}</title>
  <meta name="description" content="{{ _desc }}">

  {# === Canonical + hreflang (bezpieczne, gdy SITE_URL nie istnieje) === #}
  {% set _lang  = page.lang or 'pl' %}
  {% set samekey = page.slugKey or page.slug or 'home' %}
  {% set _slug  = page.slug or '' %}
  {% set _path  = '/' ~ _lang ~ '/' ~ (_slug ~ ('/' if _slug)) %}
  {% set _base = (SITE_URL if (SITE_URL is defined and SITE_URL) else (site_url if (site_url is defined and site_url) else 'https://kras-trans.com')) %}
  {% set _canon = _base ~ _path %}

  <link rel="canonical" href="{{ _canon }}">
  {% for alt in (pages or []) | selectattr('slugKey','equalto',samekey) | list %}
    {% set _altpath = '/' ~ (alt.lang or 'pl') ~ '/' ~ (alt.slug or '') ~ '/' %}
    <link rel="alternate" hreflang="{{ (alt.lang or 'pl')|lower }}" href="{{ _base ~ _altpath }}">
  {% endfor %}
  <link rel="alternate" hreflang="x-default" href="{{ _canon }}">

  {# OG/Twitter #}
  {% set ogimg_rel = '/' ~ (page.og_image or page.hero_image or 'assets/media/og-default.webp') %}
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ _title }}">
  <meta property="og:description" content="{{ _desc }}">
  <meta property="og:url" content="{{ _canon }}">
  <meta property="og:image" content="{{ _base ~ ogimg_rel }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ _title }}">
  <meta name="twitter:description" content="{{ _desc }}">
  <meta name="twitter:image" content="{{ _base ~ ogimg_rel }}">

  {% if GSC_VERIFICATION %}
    <meta name="google-site-verification" content="{{ GSC_VERIFICATION }}">
  {% endif %}

  <!-- Assets -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/InterVariable.woff2" crossorigin>
  <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/InterVariable-Italic.woff2" crossorigin>
  <link rel="stylesheet" href="/assets/css/kras-global.css">
</head>
<body data-header-overlay="true">
  <!-- Backgrounds -->
  <div id="bg-grid" aria-hidden="true"></div>
  <canvas id="bg-canvas" aria-hidden="true"></canvas>

  {# =================== HEADER =================== #}
  <header class="site-header" role="banner">
    <div class="container header-grid">
      <!-- LOGO -->
      <a class="brand" href="/{{ _lang }}/" aria-label="{{ (company and company[0].name) or 'Kras-Trans' }}">
        <img class="brand__logo"
             src="/assets/media/logo-firma-transportowa-kras-trans.png"
             width="160" height="40"
             alt="{{ (company and company[0].name) or 'Kras-Trans' }}"
             fetchpriority="high" loading="eager">
      </a>

      <!-- NAV -->
      <nav id="site-nav" class="nav" aria-label="{{ strings.nav_main or 'Główna nawigacja' }}">
        {% set menu = (nav or []) | selectattr('lang','equalto',_lang) | sort(attribute='order') | list %}
        {% if menu|length == 0 %}
          {% set menu = [
            {'label':'Oferta','href':'/' ~ _lang ~ '/#oferta','order':10},
            {'label':'Usługi','href':'/' ~ _lang ~ '/uslugi/','order':20},
            {'label':'Transport paletowy','href':'/' ~ _lang ~ '/transport-paletowy/','order':30},
            {'label':'Transport do Niemiec','href':'/' ~ _lang ~ '/transport-do-niemiec/','order':40},
            {'label':'Express 3,5 t','href':'/' ~ _lang ~ '/express-35t/','order':50},
            {'label':'Flota','href':'/' ~ _lang ~ '/flota/','order':60},
            {'label':'Praca','href':'/' ~ _lang ~ '/praca/','order':70},
            {'label':'FAQ','href':'/' ~ _lang ~ '/#faq','order':80},
            {'label':'Blog','href':'/' ~ _lang ~ '/blog/','order':90},
            {'label':'Kontakt','href':'/' ~ _lang ~ '/#kontakt','order':100}
          ] %}
        {% endif %}
        <ul class="nav__list">
          {% for i in menu %}
            <li><a href="{{ i.href }}">{{ i.label }}</a></li>
          {% endfor %}
        </ul>

        <!-- Language pill (działa bez JS) -->
        <details class="lang-switch" id="langs">
          <summary class="lang-pill" aria-label="{{ strings.nav_langs or 'Języki' }}" id="langBtn">
            {{ _lang|upper }} ▾
          </summary>
          <ul class="lang-menu">
            {% for alt in (pages or []) | selectattr('slugKey','equalto',samekey) | list %}
              {% set _altpath = '/' ~ (alt.lang or 'pl') ~ '/' ~ (alt.slug or '') ~ '/' %}
              <li>
                <a href="{{ _altpath }}"
                   hreflang="{{ (alt.lang or 'pl')|lower }}"
                   rel="alternate">
                   {{ (alt.lang or 'PL')|upper }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </details>
      </nav>

      <!-- Header actions -->
      <div class="header-actions">
        <button id="theme-toggle" class="icon-btn theme-toggle" type="button"
                aria-label="{{ strings.theme_toggle or 'Zmień motyw' }}"
                aria-pressed="false" title="Motyw">◐</button>

        {% set tel = (company and company[0].telephone) or strings.phone or '+48793927467' %}
        <a class="btn primary btn--shine" href="tel:{{ tel }}">
          {{ strings.cta_call or 'Zadzwoń 24/7' }}
        </a>
      </div>
    </div>
  </header>

  <main id="main" class="content" role="main">

    {# =================== HERO =================== #}
    <section class="hero" id="hero" aria-label="{{ strings.hero_aria or 'Hero' }}">
      <div class="container hero-wrap">
        <div class="hero-copy">
          {% if page.claim or strings.claim %}
            <span class="claim">{{ page.claim or strings.claim }}</span>
          {% endif %}
          <h1>{{ page.h1 or page.title or 'Transport — Polska & Europa' }}</h1>
          {% if page.lead %}<p class="lead">{{ page.lead }}</p>{% endif %}

          <p class="cta-row">
            <a id="cta-quote" class="btn primary" href="#kontakt">
              {{ strings.hero_cta_primary or 'Wyceń transport teraz' }}
            </a>
            <a class="btn" href="tel:{{ tel }}">{{ strings.hero_cta_secondary or 'Zadzwoń' }}</a>
          </p>

          <aside class="steps-bubble" aria-label="{{ strings.steps_label or 'Jak to działa' }}">
            <ol>
              <li>{{ strings.step1 or 'Krok 1: Kliknij „Wyceń transport teraz”.' }}</li>
              <li>{{ strings.step2 or 'Krok 2: Podaj trasę i dane ładunku.' }}</li>
              <li>{{ strings.step3 or 'Krok 3: Wyślij — oddzwonimy i potwierdzimy odbiór.' }}</li>
            </ol>
            <small class="hint">
              {{ strings.steps_hint or 'Darmowa wycena • Bez ukrytych opłat • Szybki kontakt po wysłaniu' }}
            </small>
          </aside>
        </div>

        <div class="hero-media">
          {% if page.hero_video %}
            <video muted loop playsinline preload="none"
                   poster="{{ page.hero_poster or '/assets/media/hero.webp' }}"
                   width="1680" height="720">
              <source src="{{ page.hero_video }}" type="video/mp4">
            </video>
          {% elif page.hero_image %}
            <img src="{{ page.hero_image }}" alt="{{ page.hero_alt or page.h1 or page.title }}"
                 width="1680" height="720" fetchpriority="high">
          {% else %}
            <img src="/assets/media/hero.webp" alt="{{ page.h1 or page.title }}"
                 width="1680" height="720" fetchpriority="high">
          {% endif %}
        </div>
      </div>
    </section>

    {# =================== OFERTA =================== #}
    <section class="section --line" id="oferta" data-section="offers"
             aria-label="{{ strings.offers_aria or 'Nasza oferta' }}">
      <div class="container text">
        <h2>{{ strings.offers_title or 'Nasza oferta' }}</h2>
        {% if strings.offers_desc %}<p>{{ strings.offers_desc }}</p>{% endif %}
      </div>

      {# 1) Blocks: block=offer (per page/lang); 2) fallback: Pages type=service #}
      {% set offers_blocks = (blocks or [])
        | selectattr('block','equalto','offer')
        | selectattr('lang','equalto',_lang)
        | selectattr('page','equalto',samekey)
        | sort(attribute='order') | list %}
      {% set offers_pages = (pages or [])
        | selectattr('type','equalto','service')
        | selectattr('lang','equalto',_lang)
        | sort(attribute='order') | list %}
      {% set offers = offers_blocks if offers_blocks|length else offers_pages %}

      {% if offers|length %}
      <div class="container cards tilt-cards cards--wrap cards--scroll" data-equalize="true"
           aria-label="{{ strings.offers_list or 'Lista usług (przesuń w bok na telefonie)' }}">
        {% for it in offers %}
          {% set url = it.href or it.url or ('/' ~ _lang ~ '/' ~ (it.slug or '') ~ '/') %}
          <article class="card offer">
            <div class="pad">
              <h3>{{ it.title or it.h1 or it.seo_title or it.slug }}</h3>
              {% if it.desc or it.lead or it.meta_desc %}
                <p>{{ it.desc or it.lead or it.meta_desc }}</p>
              {% endif %}
              {% if url %}
                <a class="btn" href="{{ url }}">
                  {{ it.cta or strings.read_more or 'Poznaj usługę' }}
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
      {% endif %}

      <div class="sep sep--morph" data-morph="wave-2" aria-hidden="true"></div>
    </section>

    {# =================== KIERUNKI / MAPA =================== #}
    <section class="section --line" id="kierunki" aria-label="{{ strings.routes_title or 'Kierunki i specjalizacje' }}">
      <div class="container text">
        <h2>{{ strings.routes_title or 'Kierunki i specjalizacje' }}</h2>
        {% if strings.routes_desc %}<p>{{ strings.routes_desc }}</p>{% endif %}
      </div>

      <div class="container">
        <div class="map-embed">
          <iframe src="/assets/media/mapa-kierunkow-kras-trans.html"
                  title="Mapa kierunków" loading="lazy"
                  width="100%" height="100%" style="border:0; aspect-ratio: 16 / 10;"></iframe>
        </div>
      </div>
    </section>

    {# =================== BODY_MD / PAGE_HTML =================== #}
    {% if page_html %}
      <section class="section --dots" id="content">
        <div class="container md">
          {{ page_html | safe }}
        </div>
      </section>
    {% endif %}

    {# =================== FAQ =================== #}
    {% if faq and faq|length %}
    <section class="section --dots" id="faq" aria-label="{{ strings.faq_aria or 'Najczęstsze pytania' }}">
      <div class="container text"><h2>{{ strings.faq_title or 'FAQ — najczęstsze pytania' }}</h2></div>
      <div class="container cards cards--wrap" data-equalize="true">
        {% for f in faq | sort(attribute='order') %}
          <details class="card">
            <summary><strong>{{ f.question }}</strong></summary>
            <div class="pad"><p>{{ f.answer }}</p></div>
          </details>
        {% endfor %}
      </div>
      <p class="container">
        <a class="btn" href="/{{ _lang }}/faq/">{{ strings.faq_more or 'Pokaż więcej pytań' }}</a>
      </p>
    </section>
    {% endif %}

    {# =================== POWIĄZANE =================== #}
    {% set related = (pages or [])
      | selectattr('lang','equalto',_lang)
      | selectattr('parentSlug','equalto',page.parentSlug)
      | rejectattr('slugKey','equalto',samekey)
      | list %}
    {% if related|length %}
    <section class="section --line" id="related">
      <div class="container text"><h2>{{ strings.related_title or 'Powiązane strony' }}</h2></div>
      <div class="container cards cards--wrap">
        {% for r in related[:6] %}
          <article class="card"><div class="pad">
            <h3><a href="/{{ _lang }}/{{ r.slug }}/">{{ r.h1 or r.title or r.seo_title }}</a></h3>
            {% if r.meta_desc %}<p>{{ r.meta_desc }}</p>{% endif %}
          </div></article>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {# =================== PANEL BOCZNY =================== #}
    <aside id="assist-panel" aria-label="Szybkie skróty">
      <nav>
        <a href="#kontakt">Wycena</a>
        <a href="tel:{{ tel }}">Zadzwoń</a>
        <a href="/{{ _lang }}/faq/">FAQ</a>
        <button type="button" data-action="theme">Tryb</button>
      </nav>
    </aside>

    {# =================== KONTAKT (anchor dla CTA) =================== #}
    <section class="section contact" id="kontakt" aria-label="{{ strings.contact or 'Kontakt' }}">
      <div class="container text">
        <h2>{{ strings.contact_title or 'Transport Polska – Europa | Kras-Trans' }}</h2>
        <p>
          <a class="tel" href="tel:{{ tel }}">{{ tel }}</a>
          {% if company and company[0].email %} •
          <a class="mail" href="mailto:{{ company[0].email }}">{{ company[0].email }}</a>{% endif %}
        </p>
      </div>
    </section>

  </main>

  {# =================== FOOTER =================== #}
  <footer class="site-footer" role="contentinfo">
    <div class="footer-wrap container">
      <section class="brand-col">
        <strong>{{ (company and company[0].name) or 'Kras-Trans' }}</strong><br>
        {% if company and company[0].streetAddress %}{{ company[0].streetAddress }}{% endif %}
        {% if company and company[0].postalCode %}, {{ company[0].postalCode }}{% endif %}
        {% if company and company[0].addressLocality %} {{ company[0].addressLocality }}{% endif %}<br>
        <a class="tel" href="tel:{{ tel }}">{{ tel }}</a><br>
        {% if company and company[0].email %}
          <a class="mail" href="mailto:{{ company[0].email }}">{{ company[0].email }}</a>
        {% endif %}
      </section>

      <nav class="footer-col" aria-label="{{ strings.nav_footer or 'Nawigacja w stopce' }}">
        <h4>{{ strings.nav_main or 'Nawigacja' }}</h4>
        <div class="links">
          {% set nav_items = (nav or []) | selectattr('lang','equalto',_lang) | sort(attribute='order') | list %}
          {% for item in nav_items[:8] %}
            <a href="{{ item.href }}">{{ item.label }}</a>
          {% endfor %}
        </div>
      </nav>

      <nav class="footer-col" aria-label="{{ strings.nav_services or 'Usługi' }}">
        <h4>{{ strings.services or 'Usługi' }}</h4>
        <div class="chips">
          {% set services = (pages or [])
            | selectattr('type','equalto','service')
            | selectattr('lang','equalto',_lang)
            | sort(attribute='order') | list %}
          {% for s in services[:10] %}
            <a class="chip" href="/{{ _lang }}/{{ s.slug }}/">{{ s.h1 or s.title or s.seo_title }}</a>
          {% endfor %}
        </div>
      </nav>

      <nav class="footer-col" aria-label="{{ strings.nav_routes or 'Kierunki' }}">
        <h4>{{ strings.routes or 'Kierunki' }}</h4>
        <div class="chips scroll-x">
          {% for r in (routes or []) | selectattr('lang','equalto',_lang) | sort(attribute='order') | list %}
            <a class="chip" href="{{ r.href or ('/' ~ _lang ~ '/trasa/' ~ (r.slug or '')) }}/">
              {{ r.label or r.name }}
            </a>
          {% endfor %}
        </div>
      </nav>
    </div>

    <div class="container legal">
      <small>© {{ (now or '')[:4] or '' }} {{ (company and company[0].name) or 'Kras-Trans' }}</small>
      <div class="langs">
        {% for alt in (pages or []) | selectattr('slugKey','equalto',samekey) | list %}
          {% set alt_lang = (alt.lang or DEFAULT_LANG)|lower %}
          {% set alt_slug = alt.slug or '' %}
          {% set alt_url  = '/' ~ alt_lang ~ '/' ~ (alt_slug ~ ('/' if alt_slug)) %}
          <a href="{{ alt_url }}" hreflang="{{ alt_lang }}">{{ (alt.lang or 'PL')|upper }}</a>
        {% endfor %}
      </div>
    </div>
  </footer>

  {# =================== DOCK (mobile) =================== #}
  <nav class="bottom-bar" aria-label="Skróty">
    <a href="#kontakt">📦<span>{{ strings.short_quote or 'Wycena' }}</span></a>
    <a href="#faq">❓<span>FAQ</span></a>
    <a href="tel:{{ tel }}">📞<span>{{ strings.short_call or 'Telefon' }}</span></a>
    <a href="#hero">⬆️<span>{{ strings.short_top or 'Góra' }}</span></a>
    <a href="/{{ _lang }}/transport-miedzynarodowy/">🌍<span>EU</span></a>
    <a href="#langs" onclick="(function(){var b=document.getElementById('langBtn'); if(b){b.click();} })(); return false;">🌐<span>Języki</span></a>
  </nav>

  {# =================== JSON-LD =================== #}
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"Organization",
        "name":"{{ (company and company[0].name) or 'Kras-Trans' }}",
        {% if company and company[0].url %}"url":"{{ company[0].url }}",{% endif %}
        {% if company and company[0].telephone %}"telephone":"{{ company[0].telephone }}",{% endif %}
        "logo":"{{ _base }}/assets/media/og-default.webp"
      },
      {
        "@type":"WebSite",
        "name":"{{ (company and company[0].name) or 'Kras-Trans' }}",
        "url":"{{ _base }}"
      },
      {
        "@type":"WebPage",
        "name":"{{ _title }}",
        "url":"{{ _canon }}",
        "inLanguage":"{{ _lang }}"
      }{% if faq and faq|length %},
      {
        "@type":"FAQPage",
        "mainEntity":[
          {% for f in faq %}
          { "@type":"Question", "name": {{ f.question | tojson }},
            "acceptedAnswer": { "@type":"Answer", "text": {{ f.answer | tojson }} } }{{ "," if not loop.last else "" }}
          {% endfor %}
        ]
      }{% endif %}
    ]
  }
  </script>

  <!-- JS (references only) -->
  <script src="/assets/js/kras-global.js" defer></script>
  <script src="/assets/js/menu-builder.js" defer></script>
</body>
</html>
