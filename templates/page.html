<!doctype html>
<html lang="{{ page.lang or 'pl' }}" class="no-motion">
<head>
  {% set _slug = page.slugKey or page.slug or 'home' %}
  {% set _lang = page.lang or 'pl' %}
  {% set _canon = '/' ~ _lang ~ '/' ~ (_slug ~ '/' if _slug else '') %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#ff7a1a">
  <title>{{ page.seo_title or page.title or 'Kras-Trans' }}</title>
  <meta name="description" content="{{ page.meta_desc or page.lead or '' }}">
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ page.og_title or page.seo_title or page.title }}">
  <meta property="og:description" content="{{ page.og_desc or page.meta_desc or page.lead }}">
  <meta property="og:image" content="{{ page.og_image or '/assets/media/og-default.jpg' }}">
  <meta property="og:url" content="{{ _canon }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page.seo_title or page.title }}">
  <meta name="twitter:description" content="{{ page.meta_desc or page.lead }}">
  <meta name="twitter:image" content="{{ page.og_image or '/assets/media/og-default.jpg' }}">
  <link rel="canonical" href="{{ _canon }}">
  {% if pages %}
    {% for p in pages if (p.slugKey or p.slug) == _slug %}
      <link rel="alternate" hreflang="{{ p.lang }}" href="/{{ p.lang }}/{{ p.slug or '' }}/">
    {% endfor %}
  {% endif %}
  <link rel="preload" href="/assets/fonts/InterVariable.woff2" as="font" type="font/woff2" crossorigin media="(min-width:768px)">
  <link rel="stylesheet" href="/assets/css/kras-global.css">
  <link rel="stylesheet" href="/assets/css/kras-ui.css">
  <style>.visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);white-space:nowrap;border:0}</style>
</head>

<body>
  <!-- Tła: siatka + patyczki (canvas) — domyślnie hidden; JS włączy po idle -->
  <div id="bg-grid" aria-hidden="true"></div>
  <canvas id="bg-canvas" aria-hidden="true" hidden></canvas>

  <!-- HEADER (sticky, przezroczysty, backdrop) -->
  <header class="site-header">
    <div class="container header-grid">
      <a class="brand" href="/">
        <img src="/assets/media/logo-firma-transportowa-kras-trans.png" alt="{{ company[0].name or 'Kras-Trans' }}" width="132" height="32" loading="eager" fetchpriority="high">
      </a>

      <nav id="site-nav" class="nav" hidden aria-label="{{ strings.nav_main or 'Główna nawigacja' }}"></nav>

      <div class="header-actions">
        <button id="theme-toggle" class="icon-btn theme-toggle" aria-label="{{ strings.theme_toggle or 'Zmień motyw' }}">
          <span class="sun"></span><span class="moon"></span><span class="paper"></span>
        </button>
        <a class="btn primary btn--shine" href="#kontakt">{{ strings.cta_call or 'Wyceń' }}</a>
      </div>
    </div>

    <!-- MEGA-MENU (desktop; nad hero; zasilane przez menu-builder.js) -->
    <div id="mega-root" class="mega" hidden></div>
  </header>

  <main id="main" class="content" role="main">
    <!-- HERO (21:9, bez stałego tła) -->
    <section class="hero" id="hero">
      <div class="container hero-wrap">
        <div class="hero-copy">
          <span class="claim">{{ page.claim or 'Kompleksowe usługi transportowe' }}</span>
          <h1>{{ page.h1 or page.title }}</h1>
          {% if page.lead %}<p class="lead">{{ page.lead }}</p>{% endif %}
          <p class="hero-cta">
            <a class="btn primary" href="#kontakt">{{ strings.hero_cta_primary or 'Wyceń transport teraz' }}</a>
            <a class="btn" href="tel:{{ (company and company[0].telephone) or '+48793927467' }}">{{ strings.hero_cta_secondary or 'Zadzwoń' }}</a>
          </p>
          <!-- Dymek: Jak to działa -->
          <aside class="howto" id="howto" hidden aria-live="polite">
            <ol>
              <li>Kliknij „Wyceń transport teraz”.</li>
              <li>Wpisz trasę i dane ładunku.</li>
              <li>Wyślij – oddzwonimy i potwierdzimy odbiór.</li>
            </ol>
          </aside>
        </div>
        {% if page.hero_video %}
          <video class="hero-media" muted loop playsinline preload="none" poster="{{ page.hero_poster or '' }}" width="1680" height="720">
            <source src="{{ page.hero_video or '/assets/media/hero.mp4' }}" type="video/mp4">
          </video>
        {% elif page.hero_image %}
          <img class="hero-media" src="{{ page.hero_image }}" alt="{{ page.hero_alt or page.h1 }}" width="1680" height="720" loading="eager" fetchpriority="high">
        {% endif %}
      </div>
    </section>

    <!-- OFERTA (split hero: słowo z arkuszy + kafelki w railu) -->
    <section class="section split-hero split-hero--narrow" id="offer-reveal" data-section="offers" data-style="edge" data-accent="amber" aria-label="{{ strings.offers_aria or 'Nasza oferta' }}">
      <div class="split-hero__sticky">
        <div class="split-hero__stack">
          <div class="split-hero__title" aria-hidden="true">
            <span class="title-half title-left">{{ strings.offers_title or 'Nasza oferta' }}</span>
            <span class="title-half title-right">{{ strings.offers_title or 'Nasza oferta' }}</span>
          </div>
          <h2 class="sr-only">{{ strings.offers_title or 'Nasza oferta' }}</h2>

          {% set offers = (blocks or [])|selectattr('block','equalto','offer')|selectattr('lang','equalto',(page.lang or 'pl'))|selectattr('page','equalto',(page.slugKey or page.slug or 'home'))|list %}
          {% if not offers|length %}{% set offers = (pages or [])|selectattr('type','equalto','service')|selectattr('lang','equalto',(page.lang or 'pl'))|list %}{% endif %}

          {% if offers|length %}
          <div class="split-hero__rail" id="offer-rail" role="list" aria-label="{{ strings.offers_list or 'Usługi (przesuń w bok na telefonie)' }}">
            {% for it in offers|sort(attribute='order') %}
            {% set url = it.href or it.url or '/' ~ (page.lang or 'pl') ~ '/' ~ (it.slug or '') ~ '/' %}
            <a role="listitem" class="offer-card" href="{{ url }}">
              {% if it.media %}<img src="{{ it.media }}" alt="" width="{{ it.img_w or 1280 }}" height="{{ it.img_h or 720 }}" loading="lazy" decoding="async">{% endif %}
              <span class="offer-card__title">{{ it.h1 or it.title or it.seo_title or it.slug }}</span>
              {% if it.lead or it.desc or it.meta_desc %}<span class="offer-card__desc">{{ it.lead or it.desc or it.meta_desc }}</span>{% endif %}
            </a>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
      <div class="sep sep--morph" data-morph="wave-2" aria-hidden="true"></div>
    </section>

    <!-- KIERUNKI (Twoja mapa) -->
    <section class="section" id="kierunki" data-section="kierunki" data-style="glass">
      <div class="container text"><h2>{{ strings.routes_title or 'Kierunki' }}</h2></div>
      <div class="container">
        <div class="iframe-wrap" style="aspect-ratio:16/9">
          <iframe class="routes-map" title="Mapa kierunków"
                  loading="lazy"
                  src="/assets/media/mapa-kierunkow-kras-trans.html"
                  sandbox="allow-scripts allow-same-origin"
                  referrerpolicy="no-referrer"></iframe>
        </div>
      </div>
    </section>

    <!-- FAQ / BLOG / CTA / KONTAKT – puste sloty jak w globalnym szablonie -->
    <!-- … (zostaw analogiczne sekcje: faq, blog, contact – placeholders) … -->
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <img src="/assets/media/logo-firma-transportowa-kras-trans.png" width="120" height="28" alt="Kras-Trans" loading="lazy">
        <div class="company">
          <strong>{{ company[0].name or 'Kras-Trans' }}</strong><br>
          {% if company and company[0].streetAddress %}{{ company[0].streetAddress }}{% endif %}
          {% if company and company[0].postalCode %}, {{ company[0].postalCode }}{% endif %}
          {% if company and company[0].addressLocality %} {{ company[0].addressLocality }}{% endif %}<br>
          <a href="tel:{{ (company and company[0].telephone) or '+48793927467' }}">{{ (company and company[0].telephone) or '+48 793 927 467' }}</a>
        </div>
      </div>
      <nav class="footer-links" aria-label="{{ strings.nav_footer or 'Nawigacja w stopce' }}"></nav>
    </div>
    <div class="container"><small>© {{ (now or '')[:4] or '' }} {{ company[0].name or 'Kras-Trans' }}</small></div>
  </footer>

  <!-- MOBILE DOCK -->
  <nav class="bottom-dock" aria-label="Szybka nawigacja">
    <a class="dock-btn dock-home" href="/{{ (page.lang or 'pl') }}/" aria-label="{{ strings.home or 'Start' }}"><span></span><em>Start</em></a>
    <a class="dock-btn dock-quote" href="#kontakt" aria-label="{{ strings.quote or 'Wyceń' }}"><span></span><em>Wyceń</em></a>
    <button class="dock-btn dock-menu" id="dock-menu" aria-label="{{ strings.menu or 'Menu' }}"><span></span><em>Menu</em></button>
  </nav>

  <!-- NEON MENU (fullscreen) -->
  <div id="neon-menu" class="neon" hidden aria-modal="true" role="dialog">
    <div class="neon__inner">
      <button class="neon__close" aria-label="{{ strings.close or 'Zamknij' }}">×</button>
      <nav class="neon__nav" aria-label="{{ strings.nav_main or 'Główna nawigacja' }}"></nav>
      <div class="neon__langs" aria-label="{{ strings.nav_langs or 'Języki' }}"></div>
    </div>
  </div>

  <!-- SKRYPTY -->
  <script src="/assets/js/kras-global.js" defer></script>
  <script src="/assets/js/menu-builder.js" defer></script>
  <script src="/assets/js/kras-ui.js" defer></script>
</body>
</html>
