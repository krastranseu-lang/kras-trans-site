{# ==== SAFE DEFAULTS (header) ==== #}
{% set BRAND = (company[0].name if company is defined and company|length>0 and company[0].name else 'Kras-Trans') %}
{% set _lang = (page.lang or 'pl') if page is defined else 'pl' %}

{# NAV_CFG bywa nieprzekazany ‚Äî u≈ºyj pustej mapy #}
{% set NAV = nav_cfg if nav_cfg is defined and nav_cfg else {} %}
{% set HREF = hreflang if hreflang is defined else {} %}

{# Lista jƒôzyk√≥w: z NAV.langs lub domy≈õlna #}
{% set LANGS = (NAV.langs if NAV and (NAV.langs is defined) else ['pl','en','de','fr','it','ru','ua']) %}

{# Generuj URL do strony o danym slugKey i jƒôzyku ‚Äî najpierw z hreflang, inaczej /{lang}/{slug}/ #}
{% macro link_for(slugkey, lang) -%}
  {%- set m = HREF.get(slugkey, {}) -%}
  {%- if m and m.get(lang) -%}{{ m[lang] }}
  {%- else -%}/{{ lang }}/{{ slugkey }}/
  {%- endif -%}
{%- endmacro %}

{# Proste etykiety, gdy strings nie nadejdƒÖ #}
{% set STR = (strings if strings is defined and strings else {}) %}
{% set LBL_QUOTE  = STR.get('hero_cta_primary','Wycena') %}
{% set LBL_ABOUT  = STR.get('menu_about','O nas') %}
{% set LBL_CONTACT= STR.get('menu_contact','Kontakt') %}
<!-- ============ HEADER / NAVIGATION ============ -->
<header class="site-header" role="banner">
  <div class="container navbar">
    <a class="brand" href="/{{ _lang }}/">
      <span class="brand__logo" aria-hidden="true">K</span>
      <span class="brand__name">{{ BRAND }}</span>
    </a>
    {% if NAV_CFG is defined and NAV_CFG.get('items') %}
    <nav class="nav" aria-label="Primary">
      <ul class="nav__list" role="menubar">
        {% for item in NAV_CFG.get('items') %}
          <li role="none">
            {% if item.children %}
              <button class="nav__btn" role="menuitem" aria-haspopup="true" aria-expanded="false" data-panel="panel-{{ loop.index0 }}">{{ item.label }}</button>
            {% else %}
              <a class="nav__btn" role="menuitem" href="{{ item.href }}">{{ item.label }}</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </nav>
    {% endif %}
    <div class="actions">
      <a href="#quote" class="cta nojs-hide">{{ STR.hero_cta_primary }}</a>
      <div class="lang" data-lang>
        <button class="icon-btn" aria-haspopup="true" aria-expanded="false" aria-controls="lang-panel" title="Language">üåê</button>
        <div id="lang-panel" class="lang__panel" role="menu" aria-label="Select language">
          <ul class="lang__list">
            {% for L in NAV_CFG.langs if NAV_CFG is defined and NAV_CFG.langs %}
              <li><a href="{{ L.href }}" role="menuitem">{{ L.label }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
      <button class="icon-btn hamburger" id="hamburger" aria-expanded="false" aria-controls="drawer" aria-label="Menu">‚ò∞</button>
    </div>
  </div>
  <div class="panels">
    {% set panels = menu_panels if menu_panels is defined else [] %}
    {% for key, items in panels|groupby('panel_key') %}
      <div class="panel" id="panel-{{ key }}" hidden>
        <div class="container panel__grid">
          {% for col, col_items in items|groupby('column') %}
            <div class="panel__col">
              {% for it in col_items|sort(attribute='order') %}
                {% if it.type == 'promo' %}
                  <div data-promo data-tags="{{ it.tags }}"></div>
                {% else %}
                  <a class="panel__link" href="{{ it.href }}">{{ it.label }}</a>
                {% endif %}
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</header>

<!-- ============ MOBILE DRAWER ============ -->
<div class="drawer" id="drawer" hidden aria-hidden="true">
  <nav aria-label="Mobile">
    <ul>
      {% if NAV_CFG is defined and NAV_CFG.get('items') %}
        {% for it in NAV_CFG.get('items') %}
          <li><a href="{{ it.href }}">{{ it.label }}</a></li>
        {% endfor %}
      {% endif %}
    </ul>
  </nav>
</div>

<!-- ============ DOCK (BOTTOM NAV) ============ -->
<nav class="dock" aria-label="Dock">
  <a href="/{{ _lang }}/">{{ STR.dock_home }}</a>
  <a href="#quote">Wycena</a>
  <a href="#drawer" id="dockMenu">{{ STR.dock_menu }}</a>
</nav>
