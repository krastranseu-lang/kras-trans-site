{% import '_macros/seo.html' as SEO %}
{% set BRAND = SEO.brand(company) %}
{% set _slug = page.slugKey or page.slug or 'home' %}
{% set _lang = page.lang or 'pl' %}
{% set PAGES = pages if pages is defined else [] %}
{% set BLOCKS = blocks if blocks is defined else [] %}
{% set HREFLANG = hreflang if hreflang is defined else {} %}
{% set NAV_CFG = nav_cfg if nav_cfg is defined else {} %}

{% set I18N = {
  'pl': {'hero_cta_primary':'Wyceń transport teraz','menu_contact':'Kontakt','menu_about':'O nas','licenses_label':'Licencje i ubezpieczenia','dock_home':'Start','dock_menu':'Menu'},
  'en': {'hero_cta_primary':'Get a quote','menu_contact':'Contact','menu_about':'About','licenses_label':'Licenses & insurance','dock_home':'Home','dock_menu':'Menu'},
  'de': {'hero_cta_primary':'Angebot anfordern','menu_contact':'Kontakt','menu_about':'Über uns','licenses_label':'Lizenzen & Versicherung','dock_home':'Home','dock_menu':'Menü'},
  'fr': {'hero_cta_primary':'Demander un devis','menu_contact':'Contact','menu_about':'À propos','licenses_label':'Licences & assurances','dock_home':'Accueil','dock_menu':'Menu'},
  'it': {'hero_cta_primary':'Richiedi preventivo','menu_contact':'Contatto','menu_about':'Chi siamo','licenses_label':'Licenze e assicurazioni','dock_home':'Home','dock_menu':'Menu'},
  'ru': {'hero_cta_primary':'Запросить расчёт','menu_contact':'Контакты','menu_about':'О компании','licenses_label':'Лицензии и страхование','dock_home':'Главная','dock_menu':'Меню'},
  'ua': {'hero_cta_primary':'Кошторис','menu_contact':'Контакт','menu_about':'Про нас','licenses_label':'Ліцензії та страхування','dock_home':'Головна','dock_menu':'Меню'}
} %}
{% set STR = (strings if strings is defined and strings else I18N[_lang]) %}

{% macro url_of(slugkey, lang) -%}
  {%- set map = HREFLANG[slugkey] if HREFLANG and (slugkey in HREFLANG) else {} -%}
  {%- if map and (lang in map) -%}{{ map[lang] }}
  {%- else -%}
    {%- set p = PAGES|selectattr('slugKey','equalto',slugkey)|selectattr('lang','equalto',lang)|first -%}
    {%- set the_slug = (p.slug if p and p.slug else slugkey) -%}
    /{{ lang }}/{{ the_slug }}/
  {%- endif -%}
{%- endmacro %}

<!doctype html>
<html lang="{{ _lang }}">
<head>
  <meta charset="utf-8">
  <title>{{ SEO.seo_title(page, BRAND) }}</title>
  <meta name="description" content="{{ SEO.meta_desc(page) }}">
  <link rel="canonical" href="{{ SEO.canon(page) }}">
  {{ SEO.hreflang_links(_slug, HREFLANG) | safe }}
  <style>/* critical css placeholder */</style>
  <link rel="stylesheet" href="/assets/css/app.css" media="print" onload="this.media='all'">
</head>
<body>
  {% include '_partials/header.html' %}
  <main>
    {{ page_html|safe }}
  </main>
  <script type="application/ld+json">{{ SEO.structured(page, company, BLOCKS)|tojson }}</script>
  <script type="application/ld+json">{{ {
    '@context':'https://schema.org',
    '@type':'Article',
    'headline': page.seo_title if page.seo_title is defined and page.seo_title else page.title,
    'image': page.hero_image if page.hero_image is defined else '',
    'author': {'@type':'Person','name': page.author} if page.author is defined else {},
    'datePublished': page.published if page.published is defined else '' }|tojson }}</script>
  {% if page.kpi is defined %}
  <script type="application/ld+json">{{ {
    '@context':'https://schema.org',
    '@type':'Review',
    'itemReviewed': {'@type':'Thing','name': page.h1 or page.title},
    'reviewBody': page.kpi }|tojson }}</script>
  {% endif %}
  {% include '_partials/footer.html' %}
</body>
</html>
