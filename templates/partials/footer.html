<!-- =============== FOOTER (Kras-Trans) =============== -->
<style>
  .site-footer{background:color-mix(in srgb, var(--ink, #0f172a) 95%, transparent);color:#e5e7eb}
  .site-footer a{color:inherit}
  .site-footer a:hover{opacity:.9}
  .site-footer .container{max-width:var(--maxw,1200px);margin-inline:auto;padding:32px 20px}
  .footer-grid{display:grid;gap:24px;grid-template-columns:repeat(12,minmax(0,1fr))}
  .footer__brand{grid-column:span 4;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:16px}
  .footer__cols{grid-column:span 8;display:grid;gap:16px;grid-template-columns:repeat(4,minmax(0,1fr))}
  .footer__title{margin:0 0 8px;font-size:.95rem;letter-spacing:.04em;text-transform:uppercase;color:#cbd5e1}
  .footer__list{list-style:none;margin:0;padding:0}
  .footer__list li{margin:6px 0}
  .footer-bottom{display:flex;flex-direction:column;gap:14px;margin-top:24px;padding-top:16px;border-top:1px solid rgba(255,255,255,.08);color:#94a3b8}
  .legal{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
  .legal__links{list-style:none;margin:0;padding:0;display:flex;gap:14px;flex-wrap:wrap}
  /* Related band (auto) */
  .related{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:16px}
  .related__list{list-style:none;margin:8px 0 0;padding:0;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
  .related__list a{display:block;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
  @media (max-width: 991px){
    .footer-grid{grid-template-columns:repeat(1,minmax(0,1fr))}
    .footer__brand,.footer__cols{grid-column:span 1}
    .footer__cols{grid-template-columns:repeat(2,minmax(0,1fr))}
  }
</style>

<footer class="site-footer" id="footer">
  <div class="container">
    <div class="footer-grid">
      <!-- Brand / kontakt wczytywany z CMS -->
      <section class="footer__brand" aria-labelledby="f-brand">
        <h3 class="footer__title" id="f-brand" data-i18n="companyCard">Kras-Trans</h3>
        <div id="footer-company-card">
          <!-- Wypełni JS z cms.company[0] (telefon, email, adres) -->
          <div><strong>Kras-Trans</strong></div>
          <div><a href="tel:+48793927467">+48 793 927 467</a> · <a href="https://wa.me/48793927467" target="_blank" rel="noopener">WhatsApp</a></div>
          <div><a href="mailto:order@kras-trans.com">order@kras-trans.com</a></div>
        </div>
      </section>

      <!-- Kolumny linków -->
      <div class="footer__cols">
        <nav aria-labelledby="f-services">
          <h3 class="footer__title" id="f-services" data-i18n="services">Usługi</h3>
          <ul class="footer__list" id="footer-services">
            <!-- Fallback (zastępowany przez JS) -->
            <li><a href="#">Ekspres 3,5 t</a></li>
            <li><a href="#">Transport TIR</a></li>
          </ul>
        </nav>

        <nav aria-labelledby="f-resources">
          <h3 class="footer__title" id="f-resources" data-i18n="resources">Zasoby</h3>
          <ul class="footer__list" id="footer-resources">
            <li><a href="#">Blog</a></li>
            <li><a href="#">FAQ</a></li>
          </ul>
        </nav>

        <nav aria-labelledby="f-company">
          <h3 class="footer__title" id="f-company" data-i18n="company">Firma</h3>
          <ul class="footer__list" id="footer-company">
            <li><a href="#">O firmie</a></li>
            <li><a href="#">Kontakt</a></li>
          </ul>
        </nav>

        <div>
          <h3 class="footer__title" data-i18n="follow">Kontakt & social</h3>
          <ul class="footer__list">
            <li><a href="tel:+48793927467">+48 793 927 467</a></li>
            <li><a href="mailto:order@kras-trans.com">order@kras-trans.com</a></li>
            <li><a href="#quote" data-i18n="getQuote">Wycena online</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <!-- Auto: pokazywane tylko na podstronach -->
      <div class="related" id="footer-related" hidden></div>

      <div class="legal">
        <div id="copyright">© <span id="copy-year"></span> Kras-Trans</div>
        <ul class="legal__links" id="footer-legal">
          <!-- JS podmieni na /privacy, /terms, /licenses itp. jeśli istnieją -->
        </ul>
      </div>
    </div>
  </div>
</footer>

<script>
/* ===== Footer hydrator (cms.json → linki + „Powiązane”) ===== */
(function(){
  const LOCALES = ['pl','en','de','fr','it','ru','ua'];
  const TXT = {
    services:{pl:'Usługi',en:'Services',de:'Leistungen',fr:'Services',it:'Servizi',ru:'Услуги',ua:'Послуги'},
    resources:{pl:'Zasoby',en:'Resources',de:'Ressourcen',fr:'Ressources',it:'Risorse',ru:'Материалы',ua:'Матеріали'},
    company:{pl:'Firma',en:'Company',de:'Unternehmen',fr:'Entreprise',it:'Azienda',ru:'Компания',ua:'Компанія'},
    companyCard:{pl:'Dane kontaktowe',en:'Contact',de:'Kontakt',fr:'Contact',it:'Contatti',ru:'Контакты',ua:'Контакти'},
    follow:{pl:'Kontakt & social',en:'Contact & social',de:'Kontakt & Social',fr:'Contact & social',it:'Contatti & social',ru:'Контакты и соцсети',ua:'Контакти та соцмережі'},
    getQuote:{pl:'Wycena online',en:'Get a quote',de:'Angebot anfordern',fr:'Demande de devis',it:'Richiedi preventivo',ru:'Запросить расчет',ua:'Отримати кошторис'},
    related:{pl:'Powiązane strony',en:'Related pages',de:'Verwandte Seiten',fr:'Pages associées',it:'Pagine correlate',ru:'Похожие страницы',ua:'Схожі сторінки'}
  };

  function langFromPath(){
    const m = location.pathname.match(/^\/([a-z]{2})(?:\/|$)/i);
    const l = (m && m[1] || document.documentElement.lang || 'pl').toLowerCase();
    return LOCALES.includes(l) ? l : 'pl';
  }
  const LANG = langFromPath();

  // i18n nagłówków w stopce
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k = el.getAttribute('data-i18n');
    const s = (TXT[k] && TXT[k][LANG]) || el.textContent;
    if(s) el.textContent = s;
  });
  const y=document.getElementById('copy-year'); if(y) y.textContent = new Date().getFullYear();

  // helpery
  const $ = (sel, ctx=document)=>ctx.querySelector(sel);
  function makeLi(page){
    const li = document.createElement('li');
    const a  = document.createElement('a');
    a.href = page.canonical_path || (`/${page.lang}/${page.slug ? page.slug+'/' : ''}`);
    a.textContent = page.h1 || page.title || page.slugKey || '—';
    li.appendChild(a); return li;
  }
  function orderer(a,b){ return (a.order||99)-(b.order||99) || (a.h1||'').localeCompare(b.h1||''); }

  // hydracja z cms.json
  fetch('/data/cms.json')
    .then(r=>r.json())
    .then(cms=>{
      const all = cms.pages || [];
      const pages = all.filter(p=>p.lang === LANG);
      const byKey = Object.fromEntries(pages.map(p=>[(p.slugKey||p.slug||'home'), p]));

      // Aktualne (wykryte) pismo – dopasowanie po canonical_path
      const path = location.pathname.replace(/\/+$/,'') || `/${LANG}`;
      const cur  = pages.find(p => (p.canonical_path||'').replace(/\/+$/,'') === path) || pages.find(p=>p.slugKey==='home') || {};

      // Usługi
      const services = pages.filter(p=>p.type==='service').sort(orderer).slice(0,8);
      const ulS = $('#footer-services'); if(ulS){ ulS.innerHTML=''; services.forEach(p=>ulS.appendChild(makeLi(p))); }

      // Zasoby
      const candidatesRes = ['blog','faq','reviews','casestudies','jobs'];
      const res = candidatesRes.map(k=>byKey[k]).filter(Boolean).slice(0,8);
      const ulR = $('#footer-resources'); if(ulR){ ulR.innerHTML=''; res.forEach(p=>ulR.appendChild(makeLi(p))); }

      // Firma
      const comp = [byKey['about'], byKey['why-us'], byKey['contact']].filter(Boolean);
      const ulC = $('#footer-company'); if(ulC){ ulC.innerHTML=''; comp.forEach(p=>ulC.appendChild(makeLi(p))); }

      // Legal/Regulaminy (jeśli istnieją)
      const legalKeys = ['licenses','licenses-insurance','privacy','terms'];
      const leg = legalKeys.map(k=>byKey[k]).filter(Boolean);
      const ulL = $('#footer-legal'); if(ulL){ ulL.innerHTML=''; leg.forEach(p=>ulL.appendChild(makeLi(p))); }

      // Company card z arkusza Company
      const org = (cms.company && cms.company[0]) || null;
      if(org){
        const box = $('#footer-company-card');
        if(box){
          const tel = (org.telephone||'').replace(/\s+/g,'');
          const wa  = tel.replace(/[^\d]/g,'');
          box.innerHTML = `
            <strong>${org.name||'Kras-Trans'}</strong>
            ${org.address ? `<div>${org.address}</div>` : ''}
            ${tel ? `<div><a href="tel:${tel}">${tel}</a>${wa?` · <a href="https://wa.me/${wa}" target="_blank" rel="noopener">WhatsApp</a>`:''}</div>` : ''}
            ${org.email ? `<div><a href="mailto:${org.email}">${org.email}</a></div>` : ''}
          `;
        }
      }

      // === Auto „Powiązane strony” dla podstron ===
      if(cur.slugKey && cur.slugKey !== 'home'){
        let related = pages
          .filter(p => p.slugKey !== cur.slugKey && (p.type === cur.type || p.type === 'service'))
          .sort(orderer)
          .slice(0,6);
        // Fallback: jeśli pusto, pokaż top usługi
        if(!related.length) related = services.slice(0,6);

        const wrap = $('#footer-related');
        if(wrap && related.length){
          wrap.hidden = false;
          wrap.innerHTML = `<h3 class="footer__title">${(TXT.related&&TXT.related[LANG])||'Related'}</h3><ul class="related__list"></ul>`;
          const ul = wrap.querySelector('.related__list');
          related.forEach(p=>ul.appendChild(makeLi(p)));
        }
      }
    })
    .catch(()=>{ /* cicho: fallback statyczny zostaje */ });
})();
</script>
<!-- ============ /FOOTER ============ -->
